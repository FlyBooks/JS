<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Promise的基本用法</title>
<script type="text/javascript">
	/*
	 * 
	 1.理解： 
	 Promise对象： 代表了未来某个时间将要发生的事件（通常是一个异步操作）
	 *有了Promise对象，可以将异步操作以同步的流程表达出来，避免了层层嵌套的回调函数（俗称‘回调地域’）
	 *ES6的promise是一个构造函数，用来生成promise实例
	 *
	 *2.使用promise基本步骤（2步）：
	 *创建promise对象：
	 *let promise = new Promise((resolve,reject)=>{
	 //初始化promise状态为pending
	 //执行异步操作
	 if (异步操作成功){
	 resolve(value); //修改promise的状态为fullfilled
	 } else {
	 reject(errMsg); //修改promise的状态为rejected
	 }
	 });
	
	 *调用promise的then():
		promise.then(
		function(result => console.log(result),
				errorMsg=> alert(errorMsg))		
		);
	 
	 3.promise对象的3个状态：
	  -pending: 初始化状态
	  -fullfilled: 成功状态
	  -rejected: 失败状态
	  
	 4.应用
	 *使用promise实现超时处理
	 *使用promise封装处理ajax请求
	 let request = new XMLHttpRequest();
	 request.onreadystatechange = function(){}
	 request.responseType = 'json';
	 request.open('GET',url);
	 request.send();
	 */
	 window.onload = function(){
		 console.log('1. code starting');
		 
		 setTimeout(()=>{
			 console.log('4.定时器执行');
		 },0);
		 
		 let promise = new Promise((resolve, reject)=>{
			 //1. 初始化promise的状态为pending
			 console.log('2. 初始化promise状态');
			 
			 setTimeout( ()=>{
				 //如果异步任务执行成功， 修改promise对象的状态为成功 --》 fullfilled
				 resolve('setTimeout'); //修改promise的状态为成功；    reject()可以修改状态为失败
				 //resolve函数里面可以传递参数到promise.then的第一个函数中
				 console.log(promise); //Promise { <state>: "fulfilled", <value>: undefined }
			 },0);
			 
		 });
		 
		 console.log('3. code ending');
		 
		 /*
		 1. code starting promise的基本用法.html:47:12
		 2. 初始化promise状态 promise的基本用法.html:55:13
		 3. code ending promise的基本用法.html:58:12
		 4.定时器执行
		 */
		 //说明了Promise是同步执行的
		 
		 
		 promise.then((msg)=>{
			 console.log(msg,'成功了'); //当promise对象的状态变为成功fullfilled, 会自动调用then方法的第一个回调
		 },()=>{
			 console.log('失败了'); ////当promise对象的状态变为失败rejected, 会自动调用then方法的第二个回调
			 
		 });
	 };
	 
	 
</script>
</head>
<body>

</body>
</html>
